# Experimenting with Ruby, Sinatra and PostgreSQL
You may have heard about **Ruby on Rails**. What about **sinatra**? What is it about?
Well, no worries we will be discuss about it.<br>
**Sinatra** is domain-specific-language for creating web applications in Ruby with minimal effort.

## Setting up a Sinatra App
First, make sure that you have install sinatra gem.<br>
`gem install sinatra`.<br>
or, you use gemfile, which describes **gem** dependicies required to execute associated Ruby code.<br>
Create and navigate to desired project folder and create ruby file.
`mkdir project_dir`<br>
`touch app.rb`<br>
Create gemfile `touch Gemfile` <br>
    
    source 'https://rubygems.org'

    gem 'rake'
    gem 'puma' # used puma for server run
    gem 'sinatra'
and run command `bundle install` or  `bundle` on terminal from your app directory.It will install your gem and create `Gemfile.lock`<br><br>
In app.rb file<br>
    
    require 'sinatra'

    set :bind, '0.0.0.0'
    set :port, 8080

    get '/' do
      "WELCOME TO SINATRA"
    end   

Run this file with Ruby:<br>
`ruby app.rb`
Open your browser and got to  http://localhost:8080. <br>
![localhost](https://user-images.githubusercontent.com/53853226/160815103-b3ea6d93-3c9a-42b3-ab61-dcf06e81cfd0.png)

To stop the server, press CTRL+c in the terminal.

## Let's talk about Postgres in Sinatra
Next, head over to your `Gemfile`and add new gems.

    gem 'pg' # for postgres      
    gem 'rake' # to run rake tasks
    gem 'sinatra-activerecord' # for active record model

For rake configuration, create a file name `Rakefile` in the root of your project.

add require in your Rakefile.

    require 'sinatra/activerecord'
    require 'sinatra/activerecord/rake'
    require './app'

Open `app.rb` file and add 'require `sinatra/activerecord'`.<br>

*(Note: Remember to restart the server after you make any changes in app.rb file.)*

### Connecting to your postgres database
Create a config directory in the root of your application. `mkdir config` and then `touch database.yml`.

In database.yml file add

    development:
    adapter: postgresql
    encoding: unicode
    database: sinatra_database
    pool: 2
    username: <%= ENV['DATABASE_USERNAME'] %>
    password: <%= ENV['DATABASE_PASSWORD']%>

*Note: you should create .env file  from your root directory and add your DATABASE_USERNAME=your_postgres_username and DATABASE_PASSWORD=your_postgres_password. You should also need to add `gem 'dotenv'` in your gemfile*

### Generating migration file and migrate db
1. Create a migration
    `rake db:create_migration NAME=create_posts`
    This will create your migration file in db/migrate folder. The db and migrate folder are autogenerated.
    In newly created migration, add a block that creates a posts table with the desired columns.

        def change
          create_table :posts do |t|
          t.string :title
          t.text :body
          t.timestamps null: false
        end

2. To create and migrate database
    `rake db:create db:migrate`
    This will create your database and migrate. schema.rb file is autogenerated from the current state of database.

3. Generating seed file
    First create seed file inside db/migrate folder. `touch db/migrate/seeds.rb`
    In seeds.rb file

        require_relative '../app/models/post'

        Post.create(title: 'DIGITAL WORLD', body: 'Description going on')

    Don't forget to `rake db:seed` in the terminal.<br>
    source: [seed file](https://github.com/sf-wdi-gaia/sinatra-app-seed)